volumes:
  pc:
    schema: gpt
    # bootloader configuration is shipped and managed by snapd
    bootloader: grub
    structure:
      - name: ubuntu-seed
        role: system-seed
        filesystem: vfat
        # UEFI will boot the ESP partition by default first
        type: C12A7328-F81F-11D2-BA4B-00A0C93EC93B
        size: 5G
        update:
          edition: 1
        content:
          - source: grubx64.efi
            target: EFI/ubuntu/grubx64.efi
          - source: shim.efi.signed
            target: EFI/ubuntu/shimx64.efi
          - source: boot.csv
            target: EFI/ubuntu/bootx64.csv
          - source: fb.efi
            target: EFI/boot/fbx64.efi
          - source: shim.efi.signed
            target: EFI/boot/bootx64.efi
      - name: ubuntu-boot
        role: system-boot
        filesystem: ext4
        type: 0FC63DAF-8483-4772-8E79-3D69D8477DE4
        size: 2G
        update:
          edition: 1
        content:
          - source: grubx64.efi
            target: EFI/boot/grubx64.efi
      - name: ubuntu-save
        role: system-save
        filesystem: ext4
        type: 0FC63DAF-8483-4772-8E79-3D69D8477DE4
        # Minimum size for FDE - some sources report 16M but be safe.
        min-size: 32M
        size: 1G
      - name: ubuntu-data
        role: system-data
        filesystem: ext4
        type: 0FC63DAF-8483-4772-8E79-3D69D8477DE4
        # This will be automatically resized to fill the rest of the disk anyways.
        size: 1M

connections:
  - plug: yValkNjy9WPIq8nUOB3VXGew2CP2Tgsj:removable-media
  - plug: ISHUD4ohMh9Ih45FXcYkLYkRvKpkfNRl:removable-media
  - plug: vgDIAs3PXlWFvI9QfSH9J9FmBP7grCQp:removable-media

# Some optimal commandline flags for AMD and other choices
kernel-cmdline:
  # Kernel commandline allow list.
  allow:
    # Enable and use zswap
    # https://docs.kernel.org/admin-guide/mm/zswap.html
    - zswap.enabled=*
    - zswap.compressor=*
    - zswap.max_pool_percent=*
    # Disable pressure stall information, turns off kernel resource-pressure
    # accounting.
    - psi=*
    # Use the CPU's clocksource directly.
    # https://github.com/torvalds/linux/blob/master/kernel/time/clocksource.c
    # https://docs.kernel.org/admin-guide/kernel-parameters.html
    - clocksource=*
    # Enable bootcharting on Ubuntu Core.
    - core.bootchart
  append:
    - zswap.enabled=1
    - zswap.compressor=lz4
    - zswap.max_pool_percent=20
    - psi=0
    - pci=realloc=on
    - clocksource=tsc
    - core.bootchart

# Default snap configuration
defaults:
  # dilyn-immich
  ISHUD4ohMh9Ih45FXcYkLYkRvKpkfNRl:
    host: 127.0.0.1
    location:
      media: /media/vault/pictures/immich
      upload: /media/vault/picturers/immich/upload
    ml:
      enabled: true
  # landscape-client
  ffnH0sJpX3NFAclH777M8BdXIWpo93af:
    account-name: standalone
    landscape-url: ip_placeholder
    auto-register:
      enabled: true
      computer-title-pattern: ${model}-${serial}
      wait-for-serial-as: true
